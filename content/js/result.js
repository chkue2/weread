const resultTexts = {
    understanding: {
        textResult : [
            '엄마표영어 파워를 충전하기 위해 당신에게 필요한 것은',
            '“아이에 대한 깊고 넓은 이해”입니다.',
        ],
        textDetail : '엄마표영어는 애착 관계가 형성되어 있는 부모가 어린 자녀에게 직접 영어를 가르쳐준다는 점에서 다른 교육 방법과 차별되는 강점을 지닙니다. 아이의 취향과 성향을 이해하는 부모는 아이가 어떻게 느낄지 고려하며 아이에게 딱 맞는 학습 내용과 방법을 선택할 수 있고, 아이는 같은 내용을 배우더라도 자신의 마음과 행동을 잘 이해해주는 부모와 함께 할 때 새로운 내용에 더욱 개방적인 태도를 보이게 되는 것이죠. 아이에 대한 이해를 넓히기 위해 지금부터 아이의 행동을 주의 깊게 관찰하고 전문적인 테스트를 통해 아이의 성격 특성을 파악해보면 어떨까요?',
    },
    environment: {
        textResult : [
            '엄마표영어 파워를 충전하기 위해 당신에게 필요한 것은',
            '“지지적인 엄마표영어 환경”입니다.',
        ],
        textDetail : '성공적인 엄마표영어를 하기 위해서는 규칙적인 시간을 낼 수 있어야 하고 가족과 지인, 그리고 전문가의 도움이 필요합니다. 엄마표영어를 시작한다는 것을 주변에 알리고, 엄마표영어를 성공적으로 해낸 부모님들의 이야기에 귀기울여보고, 특히 전문가와 협력하고 있는 커뮤니티를 통해 아이의 효과적인 영어학습을 위한 정보를 제공받아 보는 것은 어떨까요?',
    },
    executive: {
        textResult : [
            '엄마표영어 파워를 충전하기 위해 당신에게 필요한 것은',
            '“과감하고 빠르게 도전하는 엄마표영어 실행력”입니다.',
        ],
        textDetail : '그리고 때로는 변화하는 상황에 맞추어 학습량을 조절하는 능력도 필요합니다. 모든 것이 갖추어 졌을 때 시작하는 것도 좋지만, 시작이 반이라는 말이 있듯이 일단 첫 걸음을 떼어보는 것이 중요합니다. 그렇게 시작을 하고 나면 끊임없이 모니터링 하며 문제점을 보완해나가는 것이 중요합니다. 비슷한 목표를 가진 사람들과 함께 엄마표영어를 실행으로 옮겨보는 것은 어떨까요?',
    },
    skil: {
        textResult : [
            '엄마표영어 파워를 충전하기 위해 당신에게 필요한 것은',
            '“엄마표영어 기술”입니다.',
        ],
        textDetail : '우리 아이에게 알맞은 영어책은 무엇인지, 아이와 함께 영어책을 읽으며 어떤 질문을 해야하는지, 어떤 교재나 영어책을 골라야 하는지에 대해 이미 많은 전문가들이 조언을 제시하고 있습니다.',
    },
    efficacy: {
        textResult : [
            '엄마표영어 파워를 충전하기 위해 당신에게 필요한 것은',
            '“엄마표영어에 대한 자기효능감”입니다.',
        ],
        textDetail : '자기효능감을 키우기 위해서는 작은 계획 하나를 성취하는 경험을 통해 유능감을 맛보는 것이 중요합니다. 오늘 실천할 수 있는 작지만 구체적인 목표를 세워보세요. 어느 순간 큰 목표를 성취해낸 자신을 발견할 거에요. 그리고 목표를 성취해낸 자기 자신에게 보상을 해주세요.',
    },
    sameScore: {
        textResult : [
            '당신은 엄마표영어의 파워를 충전하기 위해',
            '필요한 요인들을 비슷한 수준으로 갖추고 있습니다.',
        ],
        textDetail : '모든 요인들을 조금씩 더 보완하면 좋지만 가장 먼저 아이에 대한 이해를 넓혀가기를 추천합니다. 엄마표영어는 애착 관계가 형성되어 있는 부모가 어린 자녀에게 직접 영어를 가르쳐준다는 점에서 다른 교육 방법과 차별되는 강점을 지닙니다. 아이의 취향과 성향에 맞는 학습 내용과 방법을 선택할 수 있고, 같은 내용을 배우더라도 아이는 자신의 마음과 행동을 잘 이해해주는 부모와 함께 할 때 새로운 내용에 더욱 개방적인 태도를 보이게 되는 것입니다. 아이에 대한 이해를 넓히기 위해 지금부터 아이의 행동을 주의 깊게 관찰하고 필요하다면 전문적인 테스트를 통해 아이의 기질과 성향을 파악해보면 어떨까요?',
    },
    highScore: {
        textResult : [
            '와우! 엄마표영어 파워 충전을 위해',
            '필요한 모든 것을 고루 갖춘 당신을 "엄마표영어 신의 경지"로 인정합니다!',
        ],
        textDetail : '아이에 대한 이해, 지지적인 주변 환경, 과감하고 빠르게 도전하는 실행력, 엄마표영어에 대한 기술, 자기효능감 모두 높은 수준으로 갖추고 있네요. 지금의 경험을 잘 기억하고 기록해두세요. 당신은 이후에 엄마표영어 전문가로 거듭날 수 있는 잠재력을 가지고 있습니다.',
    }
}

const serveyCategory = [
    'environment', 'understanding', 'executive', 'skil', 'efficacy'
]

let result = {
    environment: 0,
    understanding: 0,
    executive: 0,
    skil: 0,
    efficacy: 0,
}
let total = 0;

$(function(){
    result.environment = parseInt(getParameterByName('environment'));
    result.understanding = parseInt(getParameterByName('understanding'));
    result.executive = parseInt(getParameterByName('executive'));
    result.skil = parseInt(getParameterByName('skil'));
    result.efficacy = parseInt(getParameterByName('efficacy'));

    setChart();
    setResultText();
});

function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
}

function setChart(){
    $('#chart').remove();
    var chartHtml = '<canvas class="chart" id="chart" width="400" height="400"></canvas>';
    $('#chart_box').append(chartHtml);
    var ctx = document.getElementById('chart').getContext('2d');
    var myChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: [
                ['엄마표영어','환경'],
                ['아이에 대한','이해'],
                ['엄마표영어','실행력'],
                ['엄마표영어','기술'],
                ['엄마표영어','자기효능감']
            ],
            datasets: [{
                label: '결과',
                data: [
                    result.environment,
                    result.understanding,
                    result.executive,
                    result.skil,
                    result.efficacy,
                ],
                borderWidth: 6,
                borderColor: 'rgb(160, 255, 156)',
                backgroundColor: 'rgba(255, 255, 255, 0)'
            }]
        },
        options: {
            responsive: false,
            scale: {
                gridLines: {
                    color: "black",
                    lineWidth: 1
                },
                angleLines: {
                    display: false
                },
                ticks: {
                    beginAtZero: true,
                    min: 0,
                    max: 20,
                    stepSize: 4
                },
                pointLabels: {
                    fontSize: 12,
                    fontColor: "black",
                    fontAlign: "center"
                }
            },
            legend: {
                display: false
            }
        }
    });   
}

function getFirstScore(){
    let score = 100;

    for(var i=0; i<serveyCategory.length; i++){
        total += result[serveyCategory[i]];

        (score > result[serveyCategory[i]]) ?
            score = result[serveyCategory[i]] :
            score = score;
    }

    return score;
}

function getFirstCategory(){
    let firstScore = getFirstScore();

    for(var i=0; i<serveyCategory.length; i++){
        if(result[serveyCategory[i]] === firstScore) return serveyCategory[i];
    }

    return null;
}

function setResultText(){
    let first = getFirstCategory();
    let text = null;

    if(total < 90){
        if(
            // 동점
            result.environment
            === result.understanding
            === result.executive
            === result.skil
            === result.efficacy
        ) {
            text = resultTexts['sameScore'];
        } else {
            text = resultTexts[first];
        }
    } else {
        text = resultTexts['highScore'];
    }

    $('#percent').text(`${total}%`);

    for(var i=0; i < text.textResult.length; i++){
        $('#result').append(`<p>${text.textResult[i]}</p>`);
    }

    $('#detail').append(`<p>${text.textDetail}</p>`);
}